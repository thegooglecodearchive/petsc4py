# -*- makefile -*-

PYTHON = python

PETSC_232=/usr/local/petsc/2.3.2
PETSC_233=/usr/local/petsc/2.3.3
PETSC_DEV=${HOME}/Devel/PETSc/petsc-dev

PETSC_ARCH=linux-gnu

all: petsc-232 petsc-233 petsc-dev

petsc-232:
	${MAKE} -f misc/makefile.dev PETSC_DIR=${PETSC_232} torture
petsc-233:						       
	${MAKE} -f misc/makefile.dev PETSC_DIR=${PETSC_233} torture
petsc-dev:						       
	${MAKE} -f misc/makefile.dev PETSC_DIR=${PETSC_DEV} torture

TEST_DIR=/tmp/petsc4py-build-test
PETSC_OPTIONS='-malloc_dump -log_summary'
torture:
	${RM} -r build ${TEST_DIR}/lib/python/petsc4py*
	${PYTHON} setup.py clean --all
	${PYTHON} setup.py install --home=${TEST_DIR}
	PYTHONPATH=${TEST_DIR}/lib/python PETSC_OPTIONS=${PETSC_OPTIONS} ${PYTHON} test/runtests.py
	${RM} tests/*.py[co]
	${RM} -r build ${TEST_DIR}/lib/python/petsc4py*
